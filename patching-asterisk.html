<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Patching Asterisk</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    <link rel="shortcut icon" href="images/logo.svg">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:FILL@0..1">
    <link rel="stylesheet" href="includes/theme.css">
    <link rel="stylesheet" href="includes/prettify.css">
  </head>
  <body>
    <header>
      <a href="/"><img src="images/logo.svg" alt=""></a>
      <h2>&lt;<span>proxy</span>&gt;</h2><h1><span>USECALLMANAGER</span>.nz</h1><h2>&lt;/<span>proxy</span>&gt;</h2>
    </header>
    <main>
      <nav>
        <ul>
          <li><a href="documentation-overview.html"><span class="icon">home</span> Documentation Overview</a></li>
          <li><span class="icon selected">build</span> <b>Patching Asterisk</b></li>
          <li><a href="change-log.html"><span class="icon">news</span> Change Log</a></li>
        </ul>
        <ul>
          <li><h3>Network Configuration</h3></li>
          <li><a href="dhcp-options.html"><span class="icon">settings_ethernet</span> DHCP Options</a></li>
          <li><a href="http-provisioning.html"><span class="icon">file_download</span> HTTP Provisioning</a></li>
          <li><a href="tftp-provisioning.html"><span class="icon">file_download</span> TFTP Provisioning</a></li>
        </ul>
        <ul>
          <li><h3>Phone Configuration</h3></li>
          <li><a href="sepmac-cnf-xml.html"><span class="icon">settings_phone</span> SEPMAC.cnf.xml</a></li>
          <li><a href="dial-template.html"><span class="icon">dialpad</span> Dial Template</a></li>
          <li><a href="application-dial-rules.html"><span class="icon">bluetooth</span> Application Dial Rules</a></li>
          <li><a href="soft-keys.html"><span class="icon">power_input</span> Soft Keys</a></li>
          <li><a href="line-keys.html"><span class="icon">format_list_bulleted</span> Line Keys</a></li>
          <li><a href="feature-policy.html"><span class="icon">fact_check</span> Feature Policy</a></li>
          <li><a href="network-locale.html"><span class="icon">language</span> Network Locale</a></li>
          <li><a href="user-locale.html"><span class="icon">face</span> User Locale</a></li>
          <li><a href="load-information.html"><span class="icon">file_upload</span> Firmware Load Information</a></li>
          <li><a href="background-images.html"><span class="icon">wallpaper</span> Background Images</a></li>
          <li><a href="ring-tones.html"><span class="icon">ring_volume</span> Ring Tones</a></li>
          <li><a href="device-security.html"><span class="icon">security</span> Device Security</a></li>
          <li><a href="trust-verification.html"><span class="icon">verified</span> Trust Verification</a></li>
          <li><a href="certificate-enrollment.html"><span class="icon">card_membership</span> Certificate Enrollment</a></li>
          <li><a href="vpn-connection.html"><span class="icon">vpn_key</span> VPN Connection</a></li>
        </ul>
        <ul>
          <li><h3>Asterisk Configuration</h3></li>
          <li><a href="sip-peers.html"><span class="icon">dialer_sip</span> SIP Peers</a></li>
          <li><a href="sip-notify-commands.html"><span class="icon">settings_power</span> SIP Notify Commands</a></li>
          <li><a href="dialplan-extensions.html"><span class="icon">format_list_numbered</span> Dialplan Extensions</a></li>
          <li><a href="call-parking.html"><span class="icon">local_parking</span> Call Parking</a></li>
          <li><a href="sip-peer-options.html"><span class="icon">code</span> SIPPEER Options</a></li>
          <li><a href="rtp-streaming.html"><span class="icon">volume_up</span> RTP Streaming</a></li>
          <li><a href="command-line.html"><span class="icon">keyboard_arrow_right</span> Command Line</a></li>
          <li><a href="freepbx-integration.html"><span class="icon">view_kanban</span> FreePBX Integration</a></li>
        </ul>
        <ul>
          <li><h3>XML Services</h3></li>
          <li><a href="phone-services.html"><span class="icon">settings</span> Phone Services</a></li>
          <li><a href="cgi-execute.html"><span class="icon">phone_forwarded</span> CGI Execute</a></li>
        </ul>
        <ul>
          <li><h3>Additional Features</h3></li>
          <li><a href="as-feature-events.html"><span class="icon">extension</span> AS Feature Events</a></li>
        </ul>
      </nav>
      <article>
        <h1>Patching Asterisk</h1>
        Steps for patching, compiling and installed the modified version of Asterisk are below. You should be familiar with building from source before attempting this.<br>
        <br>
        <b>1.</b> Download a copy of the patch below.<br>
        <br>
        <table>
          <tbody>
            <tr>
              <td><b>Asterisk 20</b> (stable)</td>
              <td><a href="https://raw.githubusercontent.com/usecallmanagernz/patches/master/asterisk/cisco-usecallmanager-20.16.0.patch" download><span class="icon">file_download</span> cisco-usecallmanager-20.15.2.patch</a> (338K) <span class="icon">event</span> 21/10/2025 <span class="icon">security</span> SHA256:b01462252bf3fc51671b682b7c347a5c253213b0ec5025c23c6535aba4c8085d.</td>
            </tr>
            <tr>
              <td><b>Asterisk 22</b> (ready for testing)</td>
              <td><a href="https://raw.githubusercontent.com/usecallmanagernz/patches/master/asterisk/cisco-usecallmanager-22.7.0.patch" download><span class="icon">file_download</span> cisco-usecallmanager-22.7.0.patch</a> (1.4M) <span class="icon">event</span> 12/01/2026 <span class="icon">security</span> SHA256:4ea9807e41bfb771de9e9ceb4ef7b3355c9d3de2ab3f0559f91b3761f41e12c4.</td>
            </tr>
          </tbody>
        </table>
        <br>
        <b>Note</b>: <code class="literal">chan_sip</code> was removed from Asterisk 22 so this version of the patch contains an overhauled and modernised version of the channel driver. Obsolete features have been removed and many configuration options have been renamed, see the <a href="change-log.html">Change Log</a> for the full list.<br>
        <br>
        <b>2.</b> Download the version of Asterisk that matches the version number in the name of the patch.<br>
        <br>
        <a href="https://asterisk.org/downloads"><span class="icon">open_in_browser</span> Asterisk Downloads</a>.<br>
        <br>
        <b>3.</b> Extract the archive and apply the patch.<br>
        <br>
        <code class="command-line"><span class="prompt">~$</span> tar --extract --gzip --file asterisk-X.X.X.tar.gz
<span class="prompt">~$</span> cd asterisk-X.X.X
<span class="prompt">~/asterisk-X.X.X$</span> patch --strip=1 &lt; ../cisco-usecallmanager-X.X.X.patch</code>
        <br>
        <b>4.</b> Configure the build environment and then compile the source code.<br>
        <br>
        <code class="command-line"><span class="prompt">~/asterisk-X.X.X$</span> CFLAGS="-DENABLE_SRTP_AES_GCM -DENABLE_SRTP_AES_256" ./configure
<span class="prompt">~/asterisk-X.X.X$</span> make</code>
        <br>
        <b>5.</b> Install the patched version.<br>
        <br>
        <code class="command-line"><span class="prompt">~/asterisk-X.X.X$</span> sudo make install</code>
        <br>
        <b>6.</b> Optionally install the sample configuration files. <b>Note</b>: sample sip.conf, sip_notify.conf and res_parking.conf contain patch-specific features so you will need to do this at least once.<br>
        <br>
        <code class="command-line"><span class="prompt">~/asterisk-X.X.X$</span> sudo make samples</code>
      </article>
    </main>
    <footer>
      <span class="icon">copyright</span> Gareth Palmer and individual contributors. Documentation distributed under <a href="LICENSE">CC BY 4.0</a>.
    </footer>
  </body>
</html>
